<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÏïîÌò∏ÌôîÌèê ÌûàÌä∏Îßµ | Herdvibe</title>
<meta property="og:title" content="ÏïîÌò∏ÌôîÌèê ÌûàÌä∏Îßµ | Herdvibe">
<meta property="og:description" content="ÏãúÍ∞ÄÏ¥ùÏï° Í∏∞Ï§Ä Top 100 ÌÅ¨Î¶ΩÌÜ† ÏûêÏÇ∞ ÏùºÏùº ÏÑ±Ï†ÅÌëú">
<meta property="og:image" content="https://herdvibe.com/crypto-heatmap/og-image.png">
<meta property="og:url" content="https://herdvibe.com/crypto-heatmap/">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://t1.kakaocdn.net/kakao_js_sdk/2.7.4/kakao.min.js" integrity="sha384-DKYJZ8NLiK8MN4/C5P2dtSmLQ4KwPaoqAfyA/DfmEc1VDxu4yyC7wy6K1Ber68+" crossorigin="anonymous"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  ::-webkit-scrollbar { display: none; }
  * { -ms-overflow-style: none; scrollbar-width: none; }

  :root {
    --bg-primary: #0a0a0a;
    --bg-secondary: #111111;
    --bg-tertiary: #1a1a1a;
    --text-primary: #ffffff;
    --text-secondary: #888888;
    --text-muted: #555555;
    --accent-green: #00d4aa;
    --accent-red: #ff4757;
    --accent-yellow: #ffd43b;
    --border-color: #2a2a2a;
  }

  html, body { overflow-x: hidden; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background-color: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.6;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }

  /* ===== HEADER ===== */
  .header {
    text-align: center;
    padding: 30px 0 20px;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 20px;
  }
  .header h1 {
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: -0.5px;
    margin-bottom: 6px;
    color: var(--text-primary);
  }
  .header .subtitle {
    color: var(--text-secondary);
    font-size: 0.85rem;
  }

  /* ===== CONTROLS BAR ===== */
  .controls-bar {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 16px;
  }

  .period-toggle {
    display: flex;
    background: var(--bg-secondary);
    border-radius: 10px;
    border: 1px solid var(--border-color);
    overflow: hidden;
  }
  .period-btn {
    padding: 8px 16px;
    font-size: 0.8rem;
    font-family: 'JetBrains Mono', monospace;
    background: transparent;
    color: var(--text-secondary);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
  }
  .period-btn.active {
    background: var(--accent-yellow);
    color: #000;
    font-weight: 700;
  }
  .period-btn:hover:not(.active) {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  /* Share Buttons */
  .share-group { display: flex; gap: 6px; }
  .share-btn {
    width: 34px; height: 34px;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s ease;
    padding: 0;
  }
  .share-btn:hover { background: var(--bg-tertiary); border-color: #3a3a3a; }
  .share-btn svg { width: 16px; height: 16px; fill: currentColor; }
  .share-btn.twitter:hover { color: #1da1f2; border-color: #1da1f2; }
  .share-btn.kakao:hover { color: #fee500; border-color: #fee500; }
  .share-btn.telegram:hover { color: #0088cc; border-color: #0088cc; }
  .share-btn.instagram:hover { color: #e4405f; border-color: #e4405f; }
  .share-btn.link-copy:hover { color: var(--accent-yellow); border-color: var(--accent-yellow); }

  /* ===== CATEGORY FILTER ===== */
  .category-filter {
    display: flex;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .cat-btn {
    padding: 6px 14px;
    font-size: 0.7rem;
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg-secondary);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 500;
  }
  .cat-btn.active {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border-color: var(--accent-yellow);
    box-shadow: 0 0 10px rgba(255,212,59,0.1);
  }
  .cat-btn:hover:not(.active) { border-color: #3a3a3a; }

  /* ===== STATS BAR ===== */
  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 24px;
    padding: 12px 20px;
    font-size: 0.75rem;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border-color);
    flex-wrap: wrap;
    margin-bottom: 8px;
  }
  .stat-item span { font-weight: 700; }
  .stat-green { color: var(--accent-green); }
  .stat-red { color: var(--accent-red); }
  .stat-yellow { color: var(--accent-yellow); }

  /* ===== LEGEND ===== */
  .legend {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 4px;
    padding: 8px 20px;
    font-size: 0.65rem;
    color: var(--text-muted);
    margin-bottom: 4px;
  }
  .legend-block { width: 24px; height: 12px; border-radius: 2px; }
  .legend-label { margin: 0 8px 0 2px; }

  /* ===== TREEMAP ===== */
  .treemap-container { padding: 4px 8px 16px; width: 100%; }
  .treemap { width: 100%; position: relative; min-height: 600px; }

  .tree-cell {
    position: absolute;
    border-radius: 3px;
    overflow: hidden;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    border: 1px solid rgba(0,0,0,0.4);
    animation: cellFade 0.3s ease forwards;
    opacity: 0;
  }
  .tree-cell:hover {
    transform: scale(1.03);
    box-shadow: 0 0 20px rgba(0,0,0,0.6);
    z-index: 100;
  }
  @keyframes cellFade { to { opacity: 1; } }

  .cell-inner {
    width: 100%; height: 100%;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 4px;
    overflow: hidden;
  }
  .cell-icon {
    width: 20px; height: 20px;
    border-radius: 50%;
    margin-bottom: 2px;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
  }
  .cell-symbol {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 800;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    line-height: 1.1;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    text-align: center;
  }
  .cell-name {
    font-size: 9px; opacity: 0.7; font-weight: 400;
    line-height: 1.1; text-align: center;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
    white-space: nowrap; overflow: hidden;
    text-overflow: ellipsis; max-width: 100%;
  }
  .cell-change {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700; line-height: 1.2;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    text-align: center;
  }

  .size-xl .cell-symbol { font-size: 20px; }
  .size-xl .cell-change { font-size: 22px; }
  .size-xl .cell-name { font-size: 12px; }
  .size-xl .cell-icon { width: 32px; height: 32px; margin-bottom: 4px; }
  .size-lg .cell-symbol { font-size: 15px; }
  .size-lg .cell-change { font-size: 16px; }
  .size-lg .cell-name { font-size: 10px; }
  .size-lg .cell-icon { width: 24px; height: 24px; }
  .size-md .cell-symbol { font-size: 12px; }
  .size-md .cell-change { font-size: 13px; }
  .size-md .cell-name { font-size: 9px; }
  .size-md .cell-icon { width: 18px; height: 18px; }
  .size-sm .cell-symbol { font-size: 10px; }
  .size-sm .cell-change { font-size: 10px; }
  .size-sm .cell-name { display: none; }
  .size-sm .cell-icon { width: 14px; height: 14px; margin-bottom: 1px; }
  .size-xs .cell-symbol { font-size: 8px; }
  .size-xs .cell-change { font-size: 8px; }
  .size-xs .cell-name { display: none; }
  .size-xs .cell-icon { display: none; }

  /* ===== TOOLTIP ===== */
  .tooltip {
    position: fixed;
    background: rgba(26,26,26,0.97);
    border: 1px solid #333;
    border-radius: 10px;
    padding: 14px 16px;
    font-size: 12px;
    pointer-events: none;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.15s;
    min-width: 220px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    backdrop-filter: blur(8px);
  }
  .tooltip.show { opacity: 1; }
  .tooltip-header {
    display: flex; align-items: center; gap: 10px;
    margin-bottom: 10px; padding-bottom: 8px;
    border-bottom: 1px solid #2a2a2a;
  }
  .tooltip-icon { width: 28px; height: 28px; border-radius: 50%; background-size: cover; }
  .tooltip-name { font-weight: 700; font-size: 14px; }
  .tooltip-symbol { color: var(--text-secondary); font-size: 11px; font-family: 'JetBrains Mono', monospace; }
  .tooltip-row {
    display: flex; justify-content: space-between; margin: 5px 0;
    font-family: 'JetBrains Mono', monospace;
  }
  .tooltip-label { color: var(--text-secondary); font-size: 11px; }
  .tooltip-value { font-weight: 600; font-size: 11px; }

  /* ===== FOOTER ===== */
  .footer {
    text-align: center;
    padding: 20px;
    color: var(--text-muted);
    font-size: 0.75rem;
  }

  /* ===== LOADING ===== */
  .loading-overlay {
    display: flex; align-items: center; justify-content: center;
    min-height: 500px; flex-direction: column; gap: 16px;
  }
  .spinner {
    width: 30px; height: 30px;
    border: 3px solid var(--border-color);
    border-top-color: var(--accent-yellow);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-text { font-size: 0.8rem; color: var(--text-secondary); }

  /* ===== TOAST ===== */
  .toast {
    position: fixed; bottom: 30px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--bg-tertiary);
    color: var(--text-primary);
    padding: 10px 24px;
    border-radius: 8px;
    font-size: 0.8rem;
    border: 1px solid var(--border-color);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 2000;
    pointer-events: none;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .container { padding: 12px; }
    .header { padding: 20px 0 15px; margin-bottom: 15px; }
    .header h1 { font-size: 1.4rem; }
    .header .subtitle { font-size: 0.75rem; }
    .controls-bar { gap: 10px; }
    .period-btn { padding: 6px 12px; font-size: 0.7rem; }
    .share-btn { width: 30px; height: 30px; }
    .share-btn svg { width: 14px; height: 14px; }
    .treemap-container { padding: 2px 4px 12px; }
    .stats-bar { padding: 10px 12px; gap: 12px; font-size: 0.65rem; }
    .legend { padding: 6px 12px; font-size: 0.6rem; }
    .cat-btn { padding: 5px 10px; font-size: 0.6rem; }
  }
  @media (max-width: 480px) {
    .container { padding: 10px; }
    .header h1 { font-size: 1.2rem; }
    .period-btn { padding: 5px 10px; font-size: 0.65rem; }
  }
</style>
</head>
<body>
<div class="container">
  <header class="header">
    <h1>ÏïîÌò∏ÌôîÌèê ÌûàÌä∏Îßµ</h1>
    <p class="subtitle">ÏãúÍ∞ÄÏ¥ùÏï° Í∏∞Ï§Ä Top 100 ¬∑ Ïä§ÌÖåÏù¥Î∏îÏΩîÏù∏ Ï†úÏô∏ ¬∑ <span id="dataTimestamp">‚Äî</span></p>
  </header>

  <div class="controls-bar">
    <div class="period-toggle">
      <button class="period-btn active" data-period="24h">24H</button>
      <button class="period-btn" data-period="7d">7D</button>
      <button class="period-btn" data-period="30d">30D</button>
    </div>
    <div class="share-group">
      <button class="share-btn twitter" onclick="shareTwitter()" title="Twitter / X">
        <svg viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      </button>
      <button class="share-btn kakao" onclick="shareKakao()" title="Ïπ¥Ïπ¥Ïò§ÌÜ°">
        <svg viewBox="0 0 24 24"><path d="M12 3c-5.08 0-9.2 3.34-9.2 7.46 0 2.64 1.73 4.96 4.35 6.32l-1.1 4.07c-.1.36.32.65.63.44l4.84-3.18c.16.01.32.02.48.02 5.08 0 9.2-3.34 9.2-7.46S17.08 3 12 3z"/></svg>
      </button>
      <button class="share-btn telegram" onclick="shareTelegram()" title="ÌÖîÎ†àÍ∑∏Îû®">
        <svg viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.479.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
      </button>
      <button class="share-btn instagram" onclick="shareInstagram()" title="Ïù∏Ïä§ÌÉÄÍ∑∏Îû®">
        <svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zM12 16a4 4 0 1 1 0-8 4 4 0 0 1 0 8zm6.406-11.845a1.44 1.44 0 1 0 0 2.881 1.44 1.44 0 0 0 0-2.881z"/></svg>
      </button>
      <button class="share-btn link-copy" onclick="copyLink()" title="ÎßÅÌÅ¨ Î≥µÏÇ¨">
        <svg viewBox="0 0 24 24"><path d="M13.828 10.172a4 4 0 0 0-5.656 0l-4 4a4 4 0 1 0 5.656 5.656l1.102-1.101m-.758-4.899a4 4 0 0 0 5.656 0l4-4a4 4 0 0 0-5.656-5.656l-1.1 1.1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
    </div>
  </div>

  <div class="stats-bar">
    <div class="stat-item">Ï¥ù <span id="totalCoins" class="stat-yellow">0</span>Í∞ú</div>
    <div class="stat-item">ÏÉÅÏäπ <span id="gainCount" class="stat-green">0</span></div>
    <div class="stat-item">ÌïòÎùΩ <span id="lossCount" class="stat-red">0</span></div>
    <div class="stat-item">ÌèâÍ∑† <span id="avgChange">0%</span></div>
    <div class="stat-item">BTC ÎèÑÎØ∏ÎÑåÏä§ <span id="btcDom" class="stat-yellow">‚Äî</span></div>
  </div>

  <div class="category-filter" id="categoryFilter">
    <button class="cat-btn active" data-cat="all">Ï†ÑÏ≤¥</button>
  </div>

  <div class="legend">
    <div class="legend-block" style="background:#b71c1c"></div><span class="legend-label">‚â§-5%</span>
    <div class="legend-block" style="background:#c62828"></div><span class="legend-label">-3%</span>
    <div class="legend-block" style="background:rgba(211,47,47,0.5)"></div><span class="legend-label">-1%</span>
    <div class="legend-block" style="background:#37474f"></div><span class="legend-label">0%</span>
    <div class="legend-block" style="background:rgba(27,94,32,0.5)"></div><span class="legend-label">+1%</span>
    <div class="legend-block" style="background:#2e7d32"></div><span class="legend-label">+3%</span>
    <div class="legend-block" style="background:#00c853"></div><span class="legend-label">‚â•+5%</span>
  </div>

  <div class="treemap-container">
    <div class="treemap" id="treemap">
      <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <div class="loading-text">Loading market data...</div>
      </div>
    </div>
  </div>

  <footer class="footer">Îç∞Ïù¥ÌÑ∞ Ï∂úÏ≤ò: CoinGecko | Îß§ÏãúÍ∞Ñ ÏûêÎèô ÏóÖÎç∞Ïù¥Ìä∏ | herdvibe.com</footer>
</div>

<div class="tooltip" id="tooltip"></div>
<div class="toast" id="toast"></div>

<script>
const DATA_URL = 'data/crypto_heatmap.json';
const SHARE_URL = 'https://herdvibe.com/crypto-heatmap/';
const STABLECOINS = ['tether','usd-coin','dai','trueusd','first-digital-usd','ethena-usde','usds','paypal-usd','frax','binance-peg-busd','tether-eurt','gemini-dollar','paxos-standard','celo-dollar'];

const CATEGORIES = {
  'Layer 1': ['bitcoin','ethereum','binance-coin','solana','cardano','avalanche-2','polkadot','tron','sui','near','aptos','cosmos','algorand','hedera-hashgraph','internet-computer','sei-network','injective-protocol','kaspa','ton','fantom','the-open-network','flow','eos','neo','zilliqa','harmony','celo','theta-token','vechain','tezos','mina-protocol'],
  'Layer 2': ['matic-network','arbitrum','optimism','mantle','starknet','immutable-x','metis-token','loopring','skale'],
  'DeFi': ['uniswap','aave','lido-dao','maker','chainlink','the-graph','jupiter-exchange-solana','raydium','pancakeswap-token','curve-dao-token','synthetix-network-token','1inch','sushi','dydx','gmx','yearn-finance','rocket-pool','thorchain','ondo-finance','ethena','pendle'],
  'Meme': ['dogecoin','shiba-inu','pepe','dogwifcoin','floki','bonk','brett','mog-coin','popcat','trump-coin'],
  'AI': ['render-token','fetch-ai','singularitynet','bittensor','akash-network','worldcoin','arkham'],
  'Gaming': ['axie-infinity','the-sandbox','decentraland','gala','illuvium','enjincoin','ronin'],
  'Infra': ['filecoin','arweave','helium','livepeer','storj','pyth-network','celestia','wormhole'],
  'Exchange': ['crypto-com-chain','okb','leo-token','kucoin-shares','gate-token','bitget-token']
};

let allData = [];
let currentPeriod = '24h';
let currentCategory = 'all';

// Kakao init
try { Kakao.init('a43ed7b39fac35458f4f9df925a279b5'); } catch(e) {}

// ===== COLORS =====
function getChangeColor(c) {
  if (c >= 7) return 'rgba(0,230,118,0.95)';
  if (c >= 5) return 'rgba(0,200,83,0.9)';
  if (c >= 3) return 'rgba(46,125,50,0.9)';
  if (c >= 1) return 'rgba(27,94,32,0.7)';
  if (c >= 0) return 'rgba(38,50,56,0.8)';
  if (c >= -1) return 'rgba(55,71,79,0.8)';
  if (c >= -3) return 'rgba(183,28,28,0.7)';
  if (c >= -5) return 'rgba(211,47,47,0.85)';
  return 'rgba(255,23,68,0.9)';
}
function getTextColor(c) {
  const a = Math.abs(c);
  if (a >= 5) return '#fff';
  if (a >= 3) return '#e0e0e0';
  if (a >= 1) return '#bdbdbd';
  return '#9e9e9e';
}
function getChangeTextColor(c) {
  if (c >= 3) return '#69f0ae';
  if (c >= 0) return '#a5d6a7';
  if (c >= -3) return '#ef9a9a';
  return '#ff8a80';
}

// ===== TREEMAP LAYOUT =====
function squarify(items, x, y, w, h) {
  if (!items.length) return [];
  if (items.length === 1) { items[0].x=x; items[0].y=y; items[0].w=w; items[0].h=h; return items; }
  const total = items.reduce((s,i) => s+i.value, 0);
  if (!total) return items;
  const rects = [];
  layoutRow(items, 0, x, y, w, h, total, rects);
  return rects;
}
function layoutRow(items, si, x, y, w, h, ta, rects) {
  if (si >= items.length) return;
  const vert = w >= h;
  const rem = items.slice(si);
  const rt = rem.reduce((s,i) => s+i.value, 0);
  let row = [rem[0]], rs = rem[0].value;
  let best = worstRatio(row, rs, vert?h:w, rt, w, h);
  for (let i=1; i<rem.length; i++) {
    const tr = [...row, rem[i]], ts = rs + rem[i].value;
    const r = worstRatio(tr, ts, vert?h:w, rt, w, h);
    if (r <= best) { row=tr; rs=ts; best=r; } else break;
  }
  const frac = rs / rt;
  if (vert) {
    const rw = w * frac; let cy = y;
    for (const it of row) { const ih = (it.value/rs)*h; it.x=x; it.y=cy; it.w=rw; it.h=ih; rects.push(it); cy+=ih; }
    layoutRow(items, si+row.length, x+rw, y, w-rw, h, ta, rects);
  } else {
    const rh = h * frac; let cx = x;
    for (const it of row) { const iw = (it.value/rs)*w; it.x=cx; it.y=y; it.w=iw; it.h=rh; rects.push(it); cx+=iw; }
    layoutRow(items, si+row.length, x, y+rh, w, h-rh, ta, rects);
  }
}
function worstRatio(row, rs, sl, ta, W, H) {
  const vert = W>=H;
  const rsz = (vert?W:H) * (rs/ta);
  if (!rsz) return Infinity;
  let worst = 0;
  for (const it of row) {
    const il = (it.value/rs) * (vert?H:W);
    const r = Math.max(rsz/il, il/rsz);
    if (r > worst) worst = r;
  }
  return worst;
}

// ===== HELPERS =====
function getCoinCategory(id) { for (const [c,ids] of Object.entries(CATEGORIES)) if (ids.includes(id)) return c; return 'Other'; }
function formatMcap(n) { if(n>=1e12) return `$${(n/1e12).toFixed(2)}T`; if(n>=1e9) return `$${(n/1e9).toFixed(1)}B`; if(n>=1e6) return `$${(n/1e6).toFixed(1)}M`; return `$${n.toLocaleString()}`; }
function formatPrice(n) { if(n>=1000) return `$${n.toLocaleString(undefined,{maximumFractionDigits:0})}`; if(n>=1) return `$${n.toFixed(2)}`; if(n>=0.01) return `$${n.toFixed(4)}`; return `$${n.toFixed(6)}`; }
function formatVol(n) { if(n>=1e9) return `$${(n/1e9).toFixed(1)}B`; if(n>=1e6) return `$${(n/1e6).toFixed(0)}M`; return `$${(n/1e3).toFixed(0)}K`; }
function getChange(coin) { if(currentPeriod==='7d') return coin.price_change_percentage_7d||0; if(currentPeriod==='30d') return coin.price_change_percentage_30d||0; return coin.price_change_percentage_24h||0; }
function showToast(msg) { const t=document.getElementById('toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2000); }

// ===== RENDER =====
function renderTreemap(data) {
  const ct = document.getElementById('treemap');
  const cw = ct.clientWidth, ch = Math.max(600, window.innerHeight-300);
  ct.style.height = ch+'px';
  let f = data.filter(c => !STABLECOINS.includes(c.id));
  if (currentCategory !== 'all') { const ci = CATEGORIES[currentCategory]||[]; f = f.filter(c => ci.includes(c.id)); }
  f.sort((a,b) => b.market_cap-a.market_cap);
  f = f.slice(0,100);
  updateStats(f);
  const items = f.map(c => ({...c, value:Math.sqrt(c.market_cap), change:getChange(c), category:getCoinCategory(c.id)}));
  const GAP=2, laid = squarify([...items], 0, 0, cw, ch);
  ct.innerHTML = '';
  laid.forEach((it, idx) => {
    const el = document.createElement('div');
    el.className = 'tree-cell';
    const w=Math.max(0,it.w-GAP), h=Math.max(0,it.h-GAP), area=w*h;
    let sc='size-xs';
    if(area>40000) sc='size-xl'; else if(area>15000) sc='size-lg'; else if(area>5000) sc='size-md'; else if(area>1500) sc='size-sm';
    el.classList.add(sc);
    const chg=it.change, sign=chg>=0?'+':'';
    el.style.cssText = `left:${it.x+GAP/2}px;top:${it.y+GAP/2}px;width:${w}px;height:${h}px;background:${getChangeColor(chg)};color:${getTextColor(chg)};animation-delay:${idx*8}ms;`;
    el.innerHTML = `<div class="cell-inner">${area>1500&&it.image?`<div class="cell-icon" style="background-image:url('${it.image}')"></div>`:''}<div class="cell-symbol">${it.symbol.toUpperCase()}</div><div class="cell-name">${it.name}</div><div class="cell-change" style="color:${getChangeTextColor(chg)}">${sign}${chg.toFixed(1)}%</div></div>`;
    el.addEventListener('mouseenter', e => showTooltip(e, it));
    el.addEventListener('mousemove', e => moveTooltip(e));
    el.addEventListener('mouseleave', hideTooltip);
    ct.appendChild(el);
  });
}

function updateStats(data) {
  const g=data.filter(c=>getChange(c)>0).length, l=data.filter(c=>getChange(c)<0).length;
  const avg=data.reduce((s,c)=>s+getChange(c),0)/(data.length||1);
  document.getElementById('totalCoins').textContent=data.length;
  document.getElementById('gainCount').textContent=g;
  document.getElementById('lossCount').textContent=l;
  const ae=document.getElementById('avgChange');
  ae.textContent=`${avg>=0?'+':''}${avg.toFixed(2)}%`;
  ae.className=avg>=0?'stat-green':'stat-red';
  const btc=data.find(c=>c.id==='bitcoin'), total=data.reduce((s,c)=>s+c.market_cap,0);
  if(btc&&total) document.getElementById('btcDom').textContent=((btc.market_cap/total)*100).toFixed(1)+'%';
}

// ===== TOOLTIP =====
function showTooltip(e, coin) {
  const tt=document.getElementById('tooltip');
  const c24=coin.price_change_percentage_24h||0, c7=coin.price_change_percentage_7d||0, c30=coin.price_change_percentage_30d||0;
  const clr=v=>v>=0?'#69f0ae':'#ff8a80';
  const sgn=v=>v>=0?'+':'';
  tt.innerHTML=`<div class="tooltip-header">${coin.image?`<div class="tooltip-icon" style="background-image:url('${coin.image}')"></div>`:''}<div><div class="tooltip-name">${coin.name}</div><div class="tooltip-symbol">${coin.symbol.toUpperCase()} ¬∑ ${coin.category}</div></div></div><div class="tooltip-row"><span class="tooltip-label">Í∞ÄÍ≤©</span><span class="tooltip-value">${formatPrice(coin.current_price)}</span></div><div class="tooltip-row"><span class="tooltip-label">ÏãúÍ∞ÄÏ¥ùÏï°</span><span class="tooltip-value">${formatMcap(coin.market_cap)}</span></div><div class="tooltip-row"><span class="tooltip-label">24H Í±∞ÎûòÎüâ</span><span class="tooltip-value">${formatVol(coin.total_volume||0)}</span></div><div class="tooltip-row"><span class="tooltip-label">24H</span><span class="tooltip-value" style="color:${clr(c24)}">${sgn(c24)}${c24.toFixed(2)}%</span></div><div class="tooltip-row"><span class="tooltip-label">7D</span><span class="tooltip-value" style="color:${clr(c7)}">${sgn(c7)}${c7.toFixed(2)}%</span></div><div class="tooltip-row"><span class="tooltip-label">30D</span><span class="tooltip-value" style="color:${clr(c30)}">${sgn(c30)}${c30.toFixed(2)}%</span></div>`;
  tt.classList.add('show');
  moveTooltip(e);
}
function moveTooltip(e) {
  const tt=document.getElementById('tooltip'), p=16;
  let x=e.clientX+p, y=e.clientY+p;
  const r=tt.getBoundingClientRect();
  if(x+r.width>window.innerWidth) x=e.clientX-r.width-p;
  if(y+r.height>window.innerHeight) y=e.clientY-r.height-p;
  tt.style.left=x+'px'; tt.style.top=y+'px';
}
function hideTooltip() { document.getElementById('tooltip').classList.remove('show'); }

// ===== CATEGORY FILTER =====
function setupCategoryFilter() {
  const ct=document.getElementById('categoryFilter');
  Object.keys(CATEGORIES).forEach(cat => {
    const b=document.createElement('button');
    b.className='cat-btn'; b.dataset.cat=cat; b.textContent=cat;
    ct.appendChild(b);
  });
  ct.addEventListener('click', e => {
    if(!e.target.classList.contains('cat-btn')) return;
    ct.querySelectorAll('.cat-btn').forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
    currentCategory=e.target.dataset.cat;
    renderTreemap(allData);
  });
}

// ===== PERIOD TOGGLE =====
document.querySelector('.period-toggle').addEventListener('click', e => {
  if(!e.target.classList.contains('period-btn')) return;
  document.querySelectorAll('.period-btn').forEach(b=>b.classList.remove('active'));
  e.target.classList.add('active');
  currentPeriod=e.target.dataset.period;
  renderTreemap(allData);
});

// ===== SHARE =====
function shareTwitter() {
  const t='ÌÅ¨Î¶ΩÌÜ† ÏãúÏû• ÌûàÌä∏Îßµ üî• ÏãúÏ¥ù Top 100 Ïã§ÏãúÍ∞Ñ ÏÑ±Ï†ÅÌëú by @herdvibe';
  window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}&url=${encodeURIComponent(SHARE_URL)}`,'_blank');
}
function shareKakao() {
  if(typeof Kakao!=='undefined'&&Kakao.isInitialized()) {
    Kakao.Share.sendDefault({
      objectType:'feed',
      content:{title:'ÏïîÌò∏ÌôîÌèê ÌûàÌä∏Îßµ',description:'ÏãúÍ∞ÄÏ¥ùÏï° Í∏∞Ï§Ä Top 100 ÌÅ¨Î¶ΩÌÜ† ÏûêÏÇ∞ Ïã§ÏãúÍ∞Ñ ÏÑ±Ï†ÅÌëú',imageUrl:'https://herdvibe.com/crypto-heatmap/og-image.png',link:{mobileWebUrl:SHARE_URL,webUrl:SHARE_URL}},
      buttons:[{title:'ÌûàÌä∏Îßµ Î≥¥Í∏∞',link:{mobileWebUrl:SHARE_URL,webUrl:SHARE_URL}}]
    });
  } else window.open(`https://story.kakao.com/share?url=${encodeURIComponent(SHARE_URL)}`,'_blank');
}
function shareTelegram() {
  const t='ÌÅ¨Î¶ΩÌÜ† ÏãúÏû• ÌûàÌä∏Îßµ - ÏãúÏ¥ù Top 100 Ïã§ÏãúÍ∞Ñ ÏÑ±Ï†ÅÌëú';
  window.open(`https://t.me/share/url?url=${encodeURIComponent(SHARE_URL)}&text=${encodeURIComponent(t)}`,'_blank');
}
function shareInstagram() { copyLink(); showToast('üìã ÎßÅÌÅ¨ Î≥µÏÇ¨Îê®! Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Ïä§ÌÜ†Î¶¨Ïóê Î∂ôÏó¨ÎÑ£Í∏∞ ÌïòÏÑ∏Ïöî'); }
function copyLink() {
  navigator.clipboard.writeText(SHARE_URL).then(()=>showToast('‚úÖ ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§')).catch(()=>{
    const ta=document.createElement('textarea'); ta.value=SHARE_URL; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showToast('‚úÖ ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§');
  });
}

// ===== RESIZE =====
let rt; window.addEventListener('resize',()=>{clearTimeout(rt);rt=setTimeout(()=>{if(allData.length)renderTreemap(allData);},200);});

// ===== MOCK DATA =====
function generateMockData() {
  const coins=[
    {id:'bitcoin',symbol:'btc',name:'Bitcoin',market_cap:1950000000000,current_price:98500,total_volume:42000000000,image:'https://assets.coingecko.com/coins/images/1/small/bitcoin.png'},
    {id:'ethereum',symbol:'eth',name:'Ethereum',market_cap:390000000000,current_price:3250,total_volume:18000000000,image:'https://assets.coingecko.com/coins/images/279/small/ethereum.png'},
    {id:'binance-coin',symbol:'bnb',name:'BNB',market_cap:98000000000,current_price:650,total_volume:2200000000,image:'https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png'},
    {id:'solana',symbol:'sol',name:'Solana',market_cap:95000000000,current_price:198,total_volume:4500000000,image:'https://assets.coingecko.com/coins/images/4128/small/solana.png'},
    {id:'ripple',symbol:'xrp',name:'XRP',market_cap:88000000000,current_price:1.55,total_volume:3200000000,image:'https://assets.coingecko.com/coins/images/44/small/xrp-symbol-white-128.png'},
    {id:'dogecoin',symbol:'doge',name:'Dogecoin',market_cap:48000000000,current_price:0.33,total_volume:2800000000,image:'https://assets.coingecko.com/coins/images/5/small/dogecoin.png'},
    {id:'cardano',symbol:'ada',name:'Cardano',market_cap:38000000000,current_price:1.08,total_volume:1500000000,image:'https://assets.coingecko.com/coins/images/975/small/cardano.png'},
    {id:'avalanche-2',symbol:'avax',name:'Avalanche',market_cap:18000000000,current_price:44,total_volume:900000000,image:'https://assets.coingecko.com/coins/images/12559/small/Avalanche_Circle_RedWhite_Trans.png'},
    {id:'tron',symbol:'trx',name:'TRON',market_cap:16000000000,current_price:0.18,total_volume:600000000,image:'https://assets.coingecko.com/coins/images/1094/small/tron-logo.png'},
    {id:'chainlink',symbol:'link',name:'Chainlink',market_cap:15000000000,current_price:24,total_volume:1200000000,image:'https://assets.coingecko.com/coins/images/877/small/chainlink-new-logo.png'},
    {id:'polkadot',symbol:'dot',name:'Polkadot',market_cap:12000000000,current_price:8.8,total_volume:500000000,image:'https://assets.coingecko.com/coins/images/12171/small/polkadot.png'},
    {id:'the-open-network',symbol:'ton',name:'Toncoin',market_cap:14000000000,current_price:5.6,total_volume:400000000,image:'https://assets.coingecko.com/coins/images/17980/small/ton_symbol.png'},
    {id:'shiba-inu',symbol:'shib',name:'Shiba Inu',market_cap:13000000000,current_price:0.000022,total_volume:800000000,image:'https://assets.coingecko.com/coins/images/11939/small/shiba.png'},
    {id:'matic-network',symbol:'matic',name:'Polygon',market_cap:11000000000,current_price:1.1,total_volume:700000000,image:'https://assets.coingecko.com/coins/images/4713/small/matic-token-icon.png'},
    {id:'uniswap',symbol:'uni',name:'Uniswap',market_cap:9000000000,current_price:15,total_volume:500000000,image:'https://assets.coingecko.com/coins/images/12504/small/uni.jpg'},
    {id:'sui',symbol:'sui',name:'Sui',market_cap:10000000000,current_price:3.8,total_volume:1100000000,image:'https://assets.coingecko.com/coins/images/26375/small/sui_asset.jpeg'},
    {id:'near',symbol:'near',name:'NEAR',market_cap:8500000000,current_price:7.2,total_volume:600000000,image:'https://assets.coingecko.com/coins/images/10365/small/near.jpg'},
    {id:'litecoin',symbol:'ltc',name:'Litecoin',market_cap:8000000000,current_price:108,total_volume:400000000,image:'https://assets.coingecko.com/coins/images/2/small/litecoin.png'},
    {id:'pepe',symbol:'pepe',name:'Pepe',market_cap:7500000000,current_price:0.0000178,total_volume:2000000000,image:'https://assets.coingecko.com/coins/images/29850/small/pepe-token.jpeg'},
    {id:'bitcoin-cash',symbol:'bch',name:'Bitcoin Cash',market_cap:7200000000,current_price:365,total_volume:350000000,image:'https://assets.coingecko.com/coins/images/780/small/bitcoin-cash-circle.png'},
    {id:'aptos',symbol:'apt',name:'Aptos',market_cap:6800000000,current_price:14.5,total_volume:450000000,image:'https://assets.coingecko.com/coins/images/26455/small/aptos_round.png'},
    {id:'internet-computer',symbol:'icp',name:'Internet Computer',market_cap:6200000000,current_price:13.2,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/14495/small/Internet_Computer_logo.png'},
    {id:'render-token',symbol:'rndr',name:'Render',market_cap:5500000000,current_price:10.5,total_volume:600000000,image:'https://assets.coingecko.com/coins/images/11636/small/rndr.png'},
    {id:'aave',symbol:'aave',name:'Aave',market_cap:5200000000,current_price:350,total_volume:400000000,image:'https://assets.coingecko.com/coins/images/12645/small/AAVE.png'},
    {id:'bittensor',symbol:'tao',name:'Bittensor',market_cap:4800000000,current_price:680,total_volume:150000000,image:'https://assets.coingecko.com/coins/images/28452/small/ARUsPeNQ_400x400.jpeg'},
    {id:'arbitrum',symbol:'arb',name:'Arbitrum',market_cap:4500000000,current_price:1.65,total_volume:500000000,image:'https://assets.coingecko.com/coins/images/16547/small/photo_2023-03-29_21.47.00.jpeg'},
    {id:'cosmos',symbol:'atom',name:'Cosmos',market_cap:4200000000,current_price:10.8,total_volume:300000000,image:'https://assets.coingecko.com/coins/images/1481/small/cosmos_hub.png'},
    {id:'filecoin',symbol:'fil',name:'Filecoin',market_cap:4000000000,current_price:7.2,total_volume:280000000,image:'https://assets.coingecko.com/coins/images/12817/small/filecoin.png'},
    {id:'kaspa',symbol:'kas',name:'Kaspa',market_cap:4000000000,current_price:0.165,total_volume:120000000,image:'https://assets.coingecko.com/coins/images/25751/small/kaspa-icon-exchanges.png'},
    {id:'hedera-hashgraph',symbol:'hbar',name:'Hedera',market_cap:3800000000,current_price:0.105,total_volume:220000000,image:'https://assets.coingecko.com/coins/images/3688/small/hbar.png'},
    {id:'fetch-ai',symbol:'fet',name:'Fetch.ai',market_cap:3600000000,current_price:1.5,total_volume:250000000,image:'https://assets.coingecko.com/coins/images/5681/small/Fetch.jpg'},
    {id:'maker',symbol:'mkr',name:'Maker',market_cap:3500000000,current_price:3800,total_volume:180000000,image:'https://assets.coingecko.com/coins/images/1364/small/Mark_Maker.png'},
    {id:'okb',symbol:'okb',name:'OKB',market_cap:3500000000,current_price:58,total_volume:20000000,image:'https://assets.coingecko.com/coins/images/4463/small/WeChat_Image_20220118095654.png'},
    {id:'lido-dao',symbol:'ldo',name:'Lido DAO',market_cap:3200000000,current_price:3.6,total_volume:250000000,image:'https://assets.coingecko.com/coins/images/13573/small/Lido_DAO.png'},
    {id:'dogwifcoin',symbol:'wif',name:'dogwifhat',market_cap:3200000000,current_price:3.2,total_volume:900000000,image:'https://assets.coingecko.com/coins/images/33566/small/dogwifhat.jpg'},
    {id:'immutable-x',symbol:'imx',name:'Immutable',market_cap:3200000000,current_price:2.1,total_volume:120000000,image:'https://assets.coingecko.com/coins/images/17233/small/immutableX-symbol-BLK-RGB.png'},
    {id:'optimism',symbol:'op',name:'Optimism',market_cap:3100000000,current_price:2.8,total_volume:350000000,image:'https://assets.coingecko.com/coins/images/25244/small/Optimism.png'},
    {id:'injective-protocol',symbol:'inj',name:'Injective',market_cap:3000000000,current_price:35,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/12882/small/Secondary_Symbol.png'},
    {id:'vechain',symbol:'vet',name:'VeChain',market_cap:3000000000,current_price:0.041,total_volume:150000000,image:'https://assets.coingecko.com/coins/images/1167/small/VeChain-Logo-768x725.png'},
    {id:'celestia',symbol:'tia',name:'Celestia',market_cap:2800000000,current_price:15.5,total_volume:300000000,image:'https://assets.coingecko.com/coins/images/31967/small/tia.jpg'},
    {id:'algorand',symbol:'algo',name:'Algorand',market_cap:2800000000,current_price:0.34,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/4380/small/download.png'},
    {id:'ondo-finance',symbol:'ondo',name:'Ondo',market_cap:2800000000,current_price:2.0,total_volume:280000000,image:'https://assets.coingecko.com/coins/images/26580/small/ONDO.png'},
    {id:'the-graph',symbol:'grt',name:'The Graph',market_cap:2600000000,current_price:0.27,total_volume:180000000,image:'https://assets.coingecko.com/coins/images/13397/small/Graph_Token.png'},
    {id:'mantle',symbol:'mnt',name:'Mantle',market_cap:2600000000,current_price:0.78,total_volume:150000000,image:'https://assets.coingecko.com/coins/images/30980/small/token-logo.png'},
    {id:'theta-token',symbol:'theta',name:'Theta',market_cap:2500000000,current_price:2.5,total_volume:100000000,image:'https://assets.coingecko.com/coins/images/2538/small/theta-token-logo.png'},
    {id:'fantom',symbol:'ftm',name:'Fantom',market_cap:2400000000,current_price:0.85,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/4001/small/Fantom_round.png'},
    {id:'bonk',symbol:'bonk',name:'Bonk',market_cap:2200000000,current_price:0.000032,total_volume:500000000,image:'https://assets.coingecko.com/coins/images/28600/small/bonk.jpg'},
    {id:'sei-network',symbol:'sei',name:'Sei',market_cap:2200000000,current_price:0.82,total_volume:250000000,image:'https://assets.coingecko.com/coins/images/28205/small/Sei_Logo_-_Transparent.png'},
    {id:'starknet',symbol:'strk',name:'Starknet',market_cap:2000000000,current_price:2.6,total_volume:180000000,image:'https://assets.coingecko.com/coins/images/26433/small/starknet.png'},
    {id:'floki',symbol:'floki',name:'FLOKI',market_cap:2000000000,current_price:0.00021,total_volume:300000000,image:'https://assets.coingecko.com/coins/images/16746/small/PNG_image.png'},
    {id:'thorchain',symbol:'rune',name:'THORChain',market_cap:2000000000,current_price:5.9,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/6595/small/Rune200x200.png'},
    {id:'worldcoin',symbol:'wld',name:'Worldcoin',market_cap:1800000000,current_price:4.2,total_volume:300000000,image:'https://assets.coingecko.com/coins/images/31069/small/worldcoin.jpeg'},
    {id:'gala',symbol:'gala',name:'Gala',market_cap:1800000000,current_price:0.048,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/12493/small/GALA-COINGECKO.png'},
    {id:'pyth-network',symbol:'pyth',name:'Pyth',market_cap:1600000000,current_price:0.44,total_volume:120000000,image:'https://assets.coingecko.com/coins/images/31924/small/pyth.png'},
    {id:'axie-infinity',symbol:'axs',name:'Axie Infinity',market_cap:1500000000,current_price:10.5,total_volume:120000000,image:'https://assets.coingecko.com/coins/images/13029/small/axie_infinity_logo.png'},
    {id:'jupiter-exchange-solana',symbol:'jup',name:'Jupiter',market_cap:1500000000,current_price:1.1,total_volume:180000000,image:'https://assets.coingecko.com/coins/images/34188/small/jup.png'},
    {id:'pendle',symbol:'pendle',name:'Pendle',market_cap:1400000000,current_price:5.3,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/15069/small/Pendle_Logo_Normal-03.png'},
    {id:'eos',symbol:'eos',name:'EOS',market_cap:1400000000,current_price:1.25,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/738/small/eos-eos-logo.png'},
    {id:'arweave',symbol:'ar',name:'Arweave',market_cap:1300000000,current_price:19.5,total_volume:100000000,image:'https://assets.coingecko.com/coins/images/4343/small/oRt6SiEN_400x400.jpg'},
    {id:'pancakeswap-token',symbol:'cake',name:'PancakeSwap',market_cap:1200000000,current_price:4.8,total_volume:100000000,image:'https://assets.coingecko.com/coins/images/12632/small/pancakeswap-cake-logo_%281%29.png'},
    {id:'ethena',symbol:'ena',name:'Ethena',market_cap:1200000000,current_price:0.75,total_volume:200000000,image:'https://assets.coingecko.com/coins/images/36530/small/ethena.png'},
    {id:'raydium',symbol:'ray',name:'Raydium',market_cap:1100000000,current_price:4.2,total_volume:150000000,image:'https://assets.coingecko.com/coins/images/13928/small/PSigc4ie_400x400.jpg'},
    {id:'flow',symbol:'flow',name:'Flow',market_cap:1100000000,current_price:1.05,total_volume:80000000,image:'https://assets.coingecko.com/coins/images/13446/small/5f6294c0c7a8cda55cb1c936_Flow_Wordmark.png'},
    {id:'tezos',symbol:'xtz',name:'Tezos',market_cap:1000000000,current_price:1.35,total_volume:60000000,image:'https://assets.coingecko.com/coins/images/976/small/Tezos-logo.png'},
    {id:'wormhole',symbol:'w',name:'Wormhole',market_cap:1000000000,current_price:0.55,total_volume:100000000,image:'https://assets.coingecko.com/coins/images/35087/small/womrhole_logo_full_color_rgb_2000px_72ppi_fb766ac85a.png'},
    {id:'mina-protocol',symbol:'mina',name:'Mina',market_cap:900000000,current_price:1.15,total_volume:50000000,image:'https://assets.coingecko.com/coins/images/15628/small/JM4_vQ34_400x400.png'},
    {id:'helium',symbol:'hnt',name:'Helium',market_cap:900000000,current_price:6.5,total_volume:40000000,image:'https://assets.coingecko.com/coins/images/4284/small/Helium_HNT.png'},
    {id:'curve-dao-token',symbol:'crv',name:'Curve DAO',market_cap:800000000,current_price:0.62,total_volume:120000000,image:'https://assets.coingecko.com/coins/images/12124/small/Curve.png'},
    {id:'popcat',symbol:'popcat',name:'Popcat',market_cap:800000000,current_price:0.82,total_volume:150000000,image:'https://assets.coingecko.com/coins/images/33760/small/image.jpg'},
    {id:'rocket-pool',symbol:'rpl',name:'Rocket Pool',market_cap:700000000,current_price:36,total_volume:30000000,image:'https://assets.coingecko.com/coins/images/2090/small/rocket_pool_%28RPL%29.png'},
  ];
  return coins.map(c=>({...c,price_change_percentage_24h:(Math.random()-0.45)*14,price_change_percentage_7d:(Math.random()-0.45)*25,price_change_percentage_30d:(Math.random()-0.45)*40}));
}

// ===== LOAD =====
async function loadData() {
  try {
    const r = await fetch(DATA_URL);
    if(r.ok) { allData = await r.json(); allData = allData.filter(c=>!STABLECOINS.includes(c.id)); }
    else throw new Error('not found');
  } catch(e) { console.log('Mock data:', e.message); allData = generateMockData(); }
  document.getElementById('loading').remove();
  const n = new Date();
  document.getElementById('dataTimestamp').textContent = `${n.getFullYear()}.${String(n.getMonth()+1).padStart(2,'0')}.${String(n.getDate()).padStart(2,'0')} ${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')} Í∏∞Ï§Ä`;
  renderTreemap(allData);
}

setupCategoryFilter();
loadData();
</script>
</body>
</html>
